#!/bin/bash

for line in `doctl registry repository list | tail -n +2`; do
  REPOSITORY="$(echo $line | awk '{print $1}')"
  if [[ $REPOSITORY == staging-* ]]; then
    MANIFESTS="$(doctl registry repository list-manifests $REPOSITORY | grep -v latest | tail -n +2 | awk '{print $1}')"
    doctl registry repository delete-manifest $REPOSITORY $MANIFESTS
  fi
done
